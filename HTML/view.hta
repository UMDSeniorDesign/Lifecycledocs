<html>
	<head>
		<HTA:APPLICATION
		border="thin"
		borderStyle="normal"
		caption="yes"
		maximizeButton="yes"
		minimizeButton="yes"
		showInTaskbar="no"
		windowState="maximize"
		innerBorder="yes"
		navigable="yes"
		scroll="auto"
		scrollFlat="yes" />
	    <style type="text/css">
		    #preview {
		        float: right;
		        width: 60%;
		        height: 60%;
		    }
		    #tableOfContents {
		        float: left;
		        width: 40%;
		        height 80%;
		    }
		    #head {
		        width:100%%; 
		        height:20%
		    }
	    </style>
		
		<script src="../JS/loadXML.js"></script>
		<script src="../JS/updateXML.js"></script>
		<script src="../JS/saveXML.js"></script>
		<script src="../JS/store.js"></script>
		<script src="../JS/getFromCookie.js"></script>
		
		<script>
		    function getTableOfContents(file_name) {
				var counter = 1;
			
				var cookieFile = getFromCookie("fileName");
				if(file_name == "current" && cookieFile != ""){
					//set filename to the one stored in cookie so page loads Table of Contents
					file_name = cookieFile;
				}
				if(file_name == "current" && cookieFile == ""){
					//Initial Load, used to avoid null pointer error
					return;
				}
				
				var XML = loadXML(file_name);
				
				//alert(XML.parseError.errorCode); 						XML ERROR FINDERS
				//alert(XML.parseError.reason);
				//alert(XML.parseError.line);
				var y = XML.documentElement.childNodes;
				
				//alert(y);
				
				if(cookieFile != file_name){
					document.cookie = "fileName="+file_name;
					loadXMLValuesCookie(y);
				}
				
				var table = document.getElementById("tableInput");
				var text = document.getElementById("textInput");
								
				document.getElementById("tableInput").innerHTML = '';
                document.getElementById("textInput").value = '';
	       
				loadXMLValuesTOC(y, counter);
	           	getValues();
	        }		
		</script>
		
		<script>
			function loadXMLValuesCookie(node){
				for (var i = 0; i < node.length; i++) {
					document.cookie = node[i].nodeName + "=" + node[i].childNodes[0].nodeValue;
					
					if(node[i].childNodes[0].hasChildNodes()){
						loadXMLValuesCookie(node[i].childNodes);
						i++;
					}
				}
			}
		</script>
		
		<script>
			function loadXMLValuesTOC(node, counter){
				var table = document.getElementById("tableInput");
				
				//alert(node.length);
				
				for (var i = 0; i < node.length; i++) {
					table.innerHTML += ("<a href='edit.hta'; onclick='checkCookie("+counter+")';>" + node[i].nodeName + "</a> <br>");
					counter ++;
					//alert(node[i].childNodes[0].nodeValue);
					
					if(node[i].childNodes[0].hasChildNodes()) {	
						
						loadXMLValuesTOC(node[i].childNodes, counter);
						counter++;
						i++;
					} 
				}
			}
		</script>
		
		<script>
			function getValues() {
				cookiearray = document.cookie.split(';');
				
				var text = document.getElementById("textInput");

				for(var i = 1; i < cookiearray.length; i++) {
					text.value += cookiearray[i].split('=')[1];
					text.value += "\n";
				}
			}
		</script>
		
	</head>
	
	<body onload="getTableOfContents('current')">
		<div id="wrapper">
		    <div="head">
				<button onclick="getTableOfContents('NotionalSRSTEST');">NotionalSRS</button>
		        <button onclick="getTableOfContents('SoftwareRequirements');">Software Requirements</button>
		        <button onclick="getTableOfContents('TestCases');">Test Case</button>
		        <button onclick="getTableOfContents('UseCases');">Use Case</button>
		        <button onclick=location.href='rtm.hta'>Create Matrix</button>
		    </div>
			<div id="tableOfContents">
			    <h1>Table of Contents</h1>
			    <div id="tableInput"></div>
			</div>
			<div id="preview">
			    <h1>Preview</h1>
			    <textarea id="textInput" style="width: 100%; height: 100%"></textarea>
			    <button onclick="saveXML()">Save</button>
			</div>
		</div>
	</body>
</html>
