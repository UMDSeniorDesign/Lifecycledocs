<html>
	<head>
		<HTA:APPLICATION
		border="thin"
		borderStyle="normal"
		caption="yes"
		maximizeButton="yes"
		minimizeButton="yes"
		showInTaskbar="no"
		windowState="maximize"
		innerBorder="yes"
		navigable="yes"
		scroll="auto"
		scrollFlat="yes" />
	    <style type="text/css">
		    #preview {
		        float: right;
		        width: 60%;
		    }
		    #tableOfContents {
		        float: left;
		        width: 40%;
		    }
	
	    </style>
		
		<script src="../JS/loadXML.js"></script>
		<script src="../JS/updateXML.js"></script>
		<script src="../JS/saveXML.js"></script>
		<script src="../JS/getFromSessvar.js"></script>
		<script src="../JS/sessionvars.js"></script>
		
		<script>
			function checkCookie(value) {
				sessvars.value = value;
			}
		</script>
		
		<script>
			function getTabs() {
				var y = loadXML(sessvars.projectName);
				
				var name = y.documentElement.childNodes;
				var div = document.getElementById("head1");
												
				for(var i = 0; i < name.length; i++) {
					div.innerHTML += ("<button onclick=getTableOfContents('"+name[i].childNodes[0].nodeValue+"');>"+name[i].childNodes[0].nodeValue+"</button>");	// Quotes needed to be in right place
				}
			}
		</script>
		
		<script>
		    function getTableOfContents(file_name) {
				if(sessvars.projectName != undefined && sessvars.projectName != "") {
					getTabs();
					sessvars.projectName = "";
				}
				
				var counter = 0;
				sessvars.counter = 1;
			
				var sessvarFilename = getFromSessvar("fileName");
								
				if(file_name == "current" && sessvarFilename != ""){
					//set filename to the one stored in cookie so page loads Table of Contents
					file_name = sessvarFilename;
				}
				if(file_name == "current" && sessvarFilename == ""){
					//Initial Load, used to avoid null pointer error
					return;
				}
				
				var XML = loadXML(file_name);
				
				/* alert("Code: " + XML.parseError.errorCode + 								XML Error Finder
					"\nReason: " + XML.parseError.reason + 
					"\nLine: " + XML.parseError.line);
				*/
				
				var y = XML.documentElement.childNodes;
								
				if(sessvarFilename != file_name){
					sessvars.xml = "fileName="+file_name+";";
					loadXMLValuesSessvar(y, 1);
				}
				
				var table = document.getElementById("tableInput");
				var text = document.getElementById("textInput");
								
				document.getElementById("tableInput").innerHTML = '';
                document.getElementById("textInput").value = '';
	       
				loadXMLValuesTOC(y, counter);
	           	getValues();				
	        }		
		</script>
					
		<script>
			function loadXMLValuesSessvar(node, num){
				for (var i = 0; i < node.length; i++) {
					if(node[i].nodeType != 3){
						sessvars.xml += node[i].nodeName + "=" + node[i].childNodes[0].nodeValue + ";";
					}
					for(var j = 0; j < node[i].childNodes.length; j++){
						if(node[i].childNodes[j].nodeType != 3){
							sessvars.xml += node[i].childNodes[j].nodeName + "=" + node[i].childNodes[j].childNodes[0].nodeValue +";";
						}
						if(node[i].childNodes[j].hasChildNodes())
							loadXMLValuesSessvar(node[i].childNodes[j].childNodes, num);
						
					}
				}
			}
		</script>
		
		<script>
			function loadXMLValuesTOC(node, counter){
				var table = document.getElementById("tableInput");
								
				for (var i = 0; i < node.length; i++) {
					if(node[i].nodeType != 3) { 
						table.innerHTML += ("<a href='edit.hta'; onclick='checkCookie("+sessvars.counter+")';>" + node[i].nodeName + "</a> <br>");
						sessvars.counter += 1;
						//counter++;
					}	
						
					for(var j = 0; j < node[i].childNodes.length; j++){
						if(node[i].childNodes[j].nodeType != 3) {
							table.innerHTML += ("<a href='edit.hta'; onclick='checkCookie("+sessvars.counter+")';>" + node[i].childNodes[j].nodeName + "</a> <br>");
							sessvars.counter += 1;
							//counter++;
						}
						
						if(node[i].childNodes[j].hasChildNodes()) {
							loadXMLValuesTOC(node[i].childNodes[j].childNodes, sessvars.counter);
							//counter++;
						}	
					}
				}
			}
		</script>
		
		<script>
			function getValues() {
				xmlArray = sessvars.xml.split(';');
				
				var text = document.getElementById("textInput");

				for(var i = 1; i < xmlArray.length; i++) {
					var newText = xmlArray[i].split('=')[1];
					if (newText != "null"){
						text.value += newText;
						text.value += "\n";
					}
				}
			}
		</script>
		
	</head>
	
	<body onload="getTableOfContents('current')">
		<div id="wrapper">
		    <div id="head1">
				<!--
				<button onclick="getTableOfContents('NotionalSRSTEST');">NotionalSRS</button>
				<button onclick="getTableOfContents('NotionalSRSTest2');">NotionalSRSTest</button>
		        <button onclick="getTableOfContents('SoftwareRequirements');">Software Requirements</button>
		        <button onclick="getTableOfContents('TestCases');">Test Case</button>
		        <button onclick="getTableOfContents('UseCases');">Use Case</button>
				-->
		        <button onclick=location.href='rtm.hta'>Create Matrix</button>
		    </div>
			<div id="tableOfContents">
			    <h1>Table of Contents</h1>
			    <div id="tableInput"></div>
			</div>
			<div id="preview">
			    <h1>Preview</h1>
			    <textarea rows="50" id="textInput" style="width: 100%"></textarea>
			    <button onclick="saveXML()">Save</button>
			</div>
		</div>
	</body>
</html>
