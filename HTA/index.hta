<html>
    <head>
        <HTA:APPLICATION
		border="thick"
		borderStyle="normal"
		caption="yes"
		maximizeButton="yes"
		minimizeButton="yes"
		showInTaskbar="yes"
		windowState="maximize"
		innerBorder="yes"
		navigable="yes"
		scroll="auto"
		scrollFlat="yes" /> 

		<script src="../JS/load.js"></script>
		<script src="../JS/contentMenu.js"></script>
		<script src="../JS/sessionvars.js"></script>
				
		<script>
			function openProject() {	
				var v = document.getElementById("browse").value;
				if(v == "") {
					alert("Please select a project to open!");	
				}
				else {
					var varray = v.split("\\");
					sessvars.projectName = varray[varray.length-1];
					document.location.href = 'view.hta';
				}
			}
		</script>
		
		<script>
			function saveFiletoProject(xml, file){
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				//If windows 7, use this line
				//var f = fs.GetFolder("../XML");
				//If windows 8, use this line
				var f = fso.GetFolder("\Projects");
				var a = fso.CreateTextFile(f+"\\"+xml, true);
				//alert(xml);
				a.WriteLine(file.xml);
				a.Close();
				
			}
			function saveFiletoXML(xml, file){
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				//If windows 7, use this line
				//var f = fs.GetFolder("../XML");
				//If windows 8, use this line
				var f = fso.GetFolder("\XML");
				var a = fso.CreateTextFile(f+"\\"+xml, true);
				//alert(xml);
				a.WriteLine(file.xml);
				a.Close();
				
			}
			function save(projectName) {
				var f = new ActiveXObject("Scripting.FileSystemObject");
				var project = projectName+".xml";
				var file = loadProject(project);
	
				for(var j = 0; file.getElementsByTagName("file_location").length > j; j++) {
					var attr = file.getElementsByTagName("file_location")[j].childNodes[0].getAttribute("href");
					//file.getElementsByTagName("file_location")[j].childNodes[0].setAttribute
					var newFile = document.getElementById(j).value;
					//alert(attr + " " +  getName(j));
					
					var xmlFile = loadXML(attr);
					var doc = xmlFile.documentElement;
					
					doc.setAttribute("xml:base",project);
					
					//alert(attr);
					//saveFile(attr, getName(j));
					file.getElementsByTagName("file_location")[j].childNodes[0].setAttribute("href", getName(j)+".xml");
					//alert(file.xml);
					f.CopyFile("../Lifecycledocs/XML/"+attr, "../Lifecycledocs/XML/"+getName(j)+".xml", 1);
					//alert(getName(j) + " " + doc.xml);
					saveFiletoXML(getName(j), doc);
				}
				//alert(doc.xml);
				saveFiletoProject(project, file);
				
			}
			
			function getName(j) {																		// Gets names of files to saveAs
				return document.getElementById(j).value;
			}
			
			function load(projectName) {
				var project = projectName+".xml";
				var file = loadProject(project);
				
				//document.getElementById("new").innerHTML = "";
				for(var j = 0; file.getElementsByTagName("file_location").length > j; j++) {
					var attr = file.getElementsByTagName("file_location")[j].childNodes[0].getAttribute("href");
					
					document.getElementById("new").innerHTML += attr + ": <input type='text' id=" + j + ">";	
				}								
			}
			
			function setProject() {
				document.getElementById("new").style.visibility="visible";
			}
			
			function createProject() {
				var projectName = document.getElementById("projectName").value;
				
				if(projectName.substr(projectName.length - 4) == ".xml") {
						projectName = projectName.substring(0, projectName.length - 4);
					} 
			
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				
				//windows 8
				if(fso.FileExists("../Lifecycledocs/Projects/"+projectName+".xml")) {
					var r = confirm("file already exists! overwrite?")	
					if(r == true) 
						alert("file overwriten");
					else
						createProject();
				}
				
				//windows 7 
				/*
				if(fso.FileExists("../Projects/"+projectName+".xml")) {
					var r = confirm("file already exists! overwrite?")
					if(r == true) 
						alert("file overwriten");
					else
						createProject();
				}
				*/
				
				//Windows 8 function
				fso.CopyFile("../Lifecycledocs/Projects/template.xml", "../Lifecycledocs/Projects/"+projectName+".xml", 1);
								
				//Windows 7 function
				//fso.CopyFile("../Projects/template.xml", "../Projects/"+projectName+".xml", 1);
				
				load(projectName);

				sessvars.projectName = projectName+".xml";
				
			}
			
			function continueOn() {
				var projectName = document.getElementById("projectName").value;

				save(projectName);
				document.location.href = 'view.hta';
			}
		</script>
		
		<script>
			function getProjectInfo(i, project) {
				var image = document.getElementById("images");
				
				if(i==0) {
					var b = document.getElementById("browse").value;
					var varray = b.split("\\");
					var projectName = varray[varray.length-1];
				} else 
					var projectName = project;
				
				image.innerHTML = "";	
				
				var y = loadProject(projectName);
				var z = loadXML("peteProjectXSL.xsl");		
				
				//alert(y.xml);
				
				var x = y.transformNode(z);
				
				image.innerHTML = x;
			}
	</script>
	
	<script>
		function removeMember(memberName) {
			var b = document.getElementById("browse").value;
			var varray = b.split("\\");
			var projectName = varray[varray.length-1];
			
			var xmlDoc = loadProject(projectName);

						
			for(var i = 0; i < xmlDoc.getElementsByTagName("TeamMember").length; i++) {
				if(xmlDoc.getElementsByTagName("Name")[i].childNodes[0].nodeValue == memberName)	
					var n = xmlDoc.getElementsByTagName("TeamMember")[i];
			}
			
			n.setAttribute("isNewest","false");
			
			var fs = new ActiveXObject("Scripting.FileSystemObject");
			//If windows 7, use this line
			var f = fs.GetFolder("../Projects");
			//If windows 8, use this line
			var f = fs.GetFolder("\Projects");
			//var f = fs.GetFolder("\Projects");

			file = f.CreateTextFile(projectName, true);
			
			file.write(xmlDoc.xml);
			file.close();
			
					//alert(projectName);
					//alert(xmlDoc.xml);
					
			file.close();		
			getProjectInfo(1, projectName);
		}
		
		function addMember() {
			var b = document.getElementById("browse").value;
			var varray = b.split("\\");
			var file = varray[varray.length-1];
			
			var xmlDoc = loadXML(file);
			
			var n=xmlDoc.getElementsByTagName("Team")[0];
			var length = xmlDoc.getElementsByTagName("Team").length;
			
			var newel=xmlDoc.createElement("TeamMember");
			n.appendChild(newel);
			
			n=xmlDoc.getElementsByTagName("Team")[length-1];
			alert(n.value);
						
			/*var newM = prompt("New Member Name: ", "");
			var newR = prompt("New Member Role: ", "");
			
			txt="<TeamMember>";
            txt+="<Name>"+newM+"</Name>";
            txt+="<Role>"+newR+"</Role>";
			txt+="</TeamMember>";*/
			
			var parser = new DOMParser();
			
		}
	</script>
	
    </head>
<title>Lifecycle Documents</title>
    <body>
    <center>
        <div id="wrapper">
            <div id ="head">
                <div id="siteControl">
                    <button id="create" onclick=setProject()>New Project</button>
                    <button id="open" onclick=openProject()>Open Project</button>
					<input id="browse" type="file" onchange="getProjectInfo(0, '')">
                </div>
            </div>
			<button onclick=continueOn()>></button>
        </div>
		<div id="splash">
            <div id ="logo">
                <div id="images">
					<br/><br/>
					<h1>Welcome to the Lifecycle Documentation Development System!</h1>
					<a id="pic" href="http://www.navsea.navy.mil/nuwc/default.aspx" target="_blank">
                    <img src="ProjectImages/nuwc_logo.jpg" alt="nuwc_logo" width="400" height="400"></a>
					<br/><br/>
					<body background="ProjectImages/water_texture2375.jpg">
				</div>
            </div>
			<div id="new" style="visibility: hidden; float: left; width: 250px; position: absolute">
				Project Name: <input type="text" id="projectName" > <br/>			
				<button onclick="createProject()">Create Project</button>
			</div>
        </div>
		
	</center>
    </body>
</html>