<html>
    <head>
        <HTA:APPLICATION
		border="thick"
		borderStyle="normal"
		caption="yes"
		maximizeButton="yes"
		minimizeButton="yes"
		showInTaskbar="yes"
		windowState="maximize"
		innerBorder="yes"
		navigable="yes"
		scroll="auto"
		scrollFlat="yes" /> 

		<script src="../JS/load.js"></script>
		<script src="../JS/contentMenu.js"></script>
		<script src="../JS/sessionvars.js"></script>
				
		<script>
			function showProjectInfo() {
				if(document.getElementById("browse").value != "" ) {
					var varray = document.getElementById("browse").value.split("\\");
					sessvars.projectName = varray[varray.length-1];
					document.location.href = 'view.hta';
				}
				else if(document.getElementById("projectName").value != "") {
					var projectName = document.getElementById("projectName").value;
					save(projectName);
					//document.getElementById("new").innerHTML += "<br><br><button onclick='proceed()'>Proceed to Project</button>";
					getProjectInfo(1, projectName+".xml");
					//sessvars.p = projectName+".xml";
					//document.location.href = 'view.hta';
				}
			}
			
			function proceed() {
				if(document.getElementById("browse").value != "" ) {
					var varray = document.getElementById("browse").value.split("\\");
					sessvars.projectName = varray[varray.length-1];
					document.location.href = 'view.hta';
				}
				else 
					document.location.href = 'view.hta';
			}
			
		</script>
		<script>
			function saveFiletoProject(xml, file){
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				//If windows 7, use this line
				var f = fso.GetFolder("../Projects");
				var a = fso.CreateTextFile(f+"/"+xml, true);
				//If windows 8, use this line
				//var f = fso.GetFolder("\Projects");
				//var a = fso.CreateTextFile(f+"\\"+xml, true);
				
				a.Write(file.xml);
				a.Close();
			}
			function saveFiletoXML(xml, file){
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				//If windows 7, use this line
				var f = fso.GetFolder("../XML");
				var a = fso.CreateTextFile(f+"/"+xml+".xml", true);
				//If windows 8, use this line
				//var f = fso.GetFolder("\XML");
				//var a = fso.CreateTextFile(f+"\\"+xml, true);
				
				a.Write(file.xml);
				a.Close();
			}
			function save(projectName) {
				var f = new ActiveXObject("Scripting.FileSystemObject");
				var project = projectName+".xml";
				var file = loadProject(project);
				for(var j = 0; file.getElementsByTagName("file_location").length > j; j++) {
					var attr = file.getElementsByTagName("file_location")[j].childNodes[0].getAttribute("href");
					var xmlFile = loadXML(attr);
					xmlFile.documentElement.setAttribute("xml:base",project)
					file.getElementsByTagName("file_location")[j].childNodes[0].setAttribute("href", getName(j)+".xml");
					
					//windows 8
					//f.CopyFile("../Lifecycledocs/XML/"+attr, "../Lifecycledocs/XML/"+getName(j)+".xml", 1);
					//Windows 7
					f.CopyFile("../XML/"+attr, "../XML/"+getName(j)+".xml", 1);
					
					saveFiletoXML(getName(j), xmlFile);
				}
				saveFiletoProject(project, file);
			}
			
			function getName(j) {	// Gets names of files to saveAs													
				return document.getElementById(j).value;
			}
			
			function load(projectName) {
				var project = projectName+".xml";
				var file = loadProject(project);
				for(var j = 0; file.getElementsByTagName("file_location").length > j; j++) {
					var attr = file.getElementsByTagName("file_location")[j].childNodes[0].getAttribute("href");
					document.getElementById("new").innerHTML += "<p style='font-size:24px'>" + attr + "</p>" + ": <input type='text' style='width: 200px' id="+j+"> <br /><br />";	
				}			
			}
			
			function setProject() {
				document.getElementById("new").style.visibility="visible";
				document.getElementById("images").style.visibility="hidden";
			}
			
			function createProject() {
				document.getElementById("make").style.visibility="hidden";
				var projectName = document.getElementById("projectName").value;
				if(projectName.substr(projectName.length - 4) == ".xml") {
						projectName = projectName.substring(0, projectName.length - 4);
					} 
			
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				
				//windows 8
				/*if(fso.FileExists("../Lifecycledocs/Projects/"+projectName+".xml")) {
					var r = confirm("Overwrite?")	
					if(r == true) 
						alert("Overwriten");
					else
						createProject();
				}*/
				
				//windows 7 
				if(fso.FileExists("../Projects/"+projectName+".xml")) {
					var r = confirm("Overwrite?")
					if(r == true) 
						alert("Overwriten");
					else
						createProject();
				}
				
				
				//Windows 8 function
				//fso.CopyFile("../Lifecycledocs/Projects/template.xml", "../Lifecycledocs/Projects/"+projectName+".xml", 1);
								
				//Windows 7 function
				fso.CopyFile("../Projects/template.xml", "../Projects/"+projectName+".xml", 1);
				
				load(projectName);
				//alert(projectName);
				sessvars.projectName = projectName+".xml";
			}
		</script>
		
		<script>
			function getProjectInfo(i, project) {
				if(i==0) {
					var b = document.getElementById("browse").value;
					var varray = b.split("\\");
					var projectName = varray[varray.length-1];
					var image = document.getElementById("images");
				} else if(i == 1){
					var projectName = project;
					var image = document.getElementById("new");
				}
				image.innerHTML = "";
				var y = loadProject(projectName);
				var z = loadXML("peteProjectXSL.xsl");
				var x = y.transformNode(z);
				image.innerHTML = x;
				document.getElementById("add").style.visibility="visible";
				document.getElementById("button").style.visibility="visible";
			}
	</script>
	
	<script>
		function removeMember(memberName) {
			var b = document.getElementById("browse").value;
			//alert(b.split("\\")[b.split("\\").length-1]);
			if(b.value == undefined) {
				//alert(sessvars.projectName);
				var projectName = sessvars.projectName;
			}
			if (b.split("\\")[b.split("\\").length-1] != ""){
				var varray = b.split("\\");
				var projectName = varray[varray.length-1];
			}
			
			//alert(projectName);
			var xmlDoc = loadProject(projectName);

						
			for(var i = 0; i < xmlDoc.getElementsByTagName("TeamMember").length; i++) {
				if(xmlDoc.getElementsByTagName("Name")[i].childNodes[0].nodeValue == memberName)	
					var n = xmlDoc.getElementsByTagName("TeamMember")[i];
			}
			
			n.setAttribute("isNewest","false");
			
			var fs = new ActiveXObject("Scripting.FileSystemObject");
			//If windows 7, use this line
			var f = fs.GetFolder("../Projects");
			//If windows 8, use this line
			//var f = fs.GetFolder("\Projects");

			file = f.CreateTextFile(projectName, true);
			file.write(xmlDoc.xml);
			file.close();		

			if(b.value == undefined) {
				getProjectInfo(1, projectName);
			}
			if (b.split("\\")[b.split("\\").length-1] != ""){
				getProjectInfo(0, projectName);
			}	
		}
		
		function addMember() {
			var b = document.getElementById("browse").value;
			//alert(b.split("\\")[b.split("\\").length-1]);
			if(b.value == undefined) {
				//alert(sessvars.projectName);
				var projectName = sessvars.projectName;
			}
			if (b.split("\\")[b.split("\\").length-1] != ""){
				var varray = b.split("\\");
				var projectName = varray[varray.length-1];
			}
			
			//alert(projectName);
			var xmlDoc = loadProject(projectName);
			
			
			for(var i = 0; i < xmlDoc.getElementsByTagName("TeamMember").length; i++) {
				//alert(xmlDoc.getElementsByTagName("Name")[i].childNodes[0].nodeValue);
				if(xmlDoc.getElementsByTagName("TeamMember")[i].getAttribute("isNewest") == "true")	
					var oldNode = xmlDoc.getElementsByTagName("TeamMember")[i];
					var newNode = oldNode.cloneNode(true);
					for(var k = 0; k < newNode.childNodes.length; k++) {
						newNode.childNodes[k].childNodes[0].nodeValue = "";
					}
					break;
			}
			
			var m = xmlDoc.getElementsByTagName("Team")[0];
			m.appendChild(newNode);
			
			var newM = document.getElementById("member").value;
			var newR = document.getElementById("role").value;
		
			for(var k = 0; k < newNode.childNodes.length; k++) {
				if((k == 0) && (newNode.childNodes[k].childNodes[0].nodeValue == ""))
					newNode.childNodes[k].childNodes[0].nodeValue = newM;
				else if((k == 2) && (newNode.childNodes[k].childNodes[0].nodeValue == ""))
					newNode.childNodes[k].childNodes[0].nodeValue = newR;
			}
			
			
			var fs = new ActiveXObject("Scripting.FileSystemObject");
			//If windows 7, use this line
			var f = fs.GetFolder("../Projects");
			//If windows 8, use this line
			//var f = fs.GetFolder("\Projects");

			file = f.CreateTextFile(projectName, true);
			file.write(xmlDoc.xml);
			file.close();		

			if(b.value == undefined) {
				getProjectInfo(1, projectName);
			}
			if (b.split("\\")[b.split("\\").length-1] != ""){
				getProjectInfo(0, projectName);
			}
		}
	</script>
	
	<script>
		function changeMemberName(memberName) {
			var b = document.getElementById("browse").value;
			//alert(b.split("\\")[b.split("\\").length-1]);
			if(b.value == undefined) {
				//alert(sessvars.projectName);
				var projectName = sessvars.projectName;
			}
			if (b.split("\\")[b.split("\\").length-1] != ""){
				var varray = b.split("\\");
				var projectName = varray[varray.length-1];
			}
			
			//alert(projectName);
			var xmlDoc = loadProject(projectName);

						
			for(var i = 0; i < xmlDoc.getElementsByTagName("TeamMember").length; i++) {
				if(xmlDoc.getElementsByTagName("Name")[i].childNodes[0].nodeValue == memberName)	
					var n = xmlDoc.getElementsByTagName("Name")[i].childNodes[0];
			}
			var newMemberName = prompt("New Member Name: ", "");
			n.nodeValue = newMemberName;
			
			var fs = new ActiveXObject("Scripting.FileSystemObject");
			//If windows 7, use this line
			var f = fs.GetFolder("../Projects");
			//If windows 8, use this line
			//var f = fs.GetFolder("\Projects");

			file = f.CreateTextFile(projectName, true);
			file.write(xmlDoc.xml);
			file.close();		

			if(b.value == undefined) {
				getProjectInfo(1, projectName);
			}
			if (b.split("\\")[b.split("\\").length-1] != ""){
				getProjectInfo(0, projectName);
			}
		}
		
		function changeRole(memberName) {
			var b = document.getElementById("browse").value;
			//alert(b.split("\\")[b.split("\\").length-1]);
			if(b.value == undefined) {
				//alert(sessvars.projectName);
				var projectName = sessvars.projectName;
			}
			if (b.split("\\")[b.split("\\").length-1] != ""){
				var varray = b.split("\\");
				var projectName = varray[varray.length-1];
			}
			
			//alert(projectName);
			var xmlDoc = loadProject(projectName);

						
			for(var i = 0; i < xmlDoc.getElementsByTagName("TeamMember").length; i++) {
				if(xmlDoc.getElementsByTagName("Name")[i].childNodes[0].nodeValue == memberName)	
					var n = xmlDoc.getElementsByTagName("Role")[i].childNodes[0];
			}
			var newRole = prompt("New Member Role: ", "");
			n.nodeValue = newRole;
			
			var fs = new ActiveXObject("Scripting.FileSystemObject");
			//If windows 7, use this line
			var f = fs.GetFolder("../Projects");
			//If windows 8, use this line
			//var f = fs.GetFolder("\Projects");

			file = f.CreateTextFile(projectName, true);
			file.write(xmlDoc.xml);
			file.close();		

			if(b.value == undefined) {
				getProjectInfo(1, projectName);
			}
			if (b.split("\\")[b.split("\\").length-1] != ""){
				getProjectInfo(0, projectName);
			}
		}
	</script>
	
    </head>
<title>Lifecycle Documents</title>
    <body background="ProjectImages/water_texture2375.jpg">
    <center>
        <div id="wrapper">
            <div id ="head">
                <div id="siteControl">
                    <button id="create" onclick=setProject()>New Project</button>
                    <button id="open" onclick=showProjectInfo()>Show Project Info</button>
					<input id="browse" type="file" onchange="getProjectInfo(0, '')">
                </div>
            </div>
			
        </div>
		<div id="splash">
            <div id ="logo">
                <div id="images">
					<br/><br/>
					<h1>Welcome to the Lifecycle Documentation Development System!</h1>
					<a id="pic" href="http://www.navsea.navy.mil/nuwc/default.aspx" target="_blank">
                    <img src="ProjectImages/nuwc_logo.jpg" alt="nuwc_logo" width="400" height="400"></a>
					<br/><br/>
				</div>
            </div>
			<div id="new" style="visibility: hidden; position: absolute; top: 100px; left: 40%">
				<p style="font-size:30px">Project Name:</p><input autofocus style="width: 300px" type="text" id="projectName" > <br/> <br/> 			
				<button id="make" onclick="createProject()">Make My Project</button> <br /><br />
			</div>
        </div>
		<br><br>
	<table id="add" style="visibility: hidden">	
		<tr>
			<td>
				<button onclick="addMember()">Add Member</button>
			</td>
			<td>
				Name: <input id="member" type="text">
			</td>
			<td>
				Role: <input id="role" type="text">
			</td>
		</tr>
		<tr>
			<td>
				<button id="button" style="visibility: hidden;" onclick='proceed()'>Proceed to Project</button>
			</td>
		</tr>
	</table>
	</center>
	 <button style="position: absolute; left: 45%" onclick="location.href='UserManual.hta'">User Manual</button>
    </body>
</html>